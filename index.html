<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>KArsip – Pencarian Kode Klasifikasi Arsip Pemerintah Daerah</title>

    <meta name="description" content="KArsip adalah aplikasi pencarian kode klasifikasi arsip pemerintah daerah untuk arsiparis, pengelola arsip dan ASN, PNS, dan PPPK provinsi dan kabupaten/kota. Temukan kode arsip dengan cepat, dan gratis.">
    <meta name="keywords" content="kode klasifikasi arsip, arsip pemerintah, sistem kearsipan, arsip ASN, arsip PNS, klasifikasi arsip daerah">
    <meta name="author" content="KArsip">

    <meta property="og:title" content="KArsip – Pencarian Kode Klasifikasi Arsip Pemerintah Daerah">
    <meta property="og:description" content="Aplikasi pencarian kode klasifikasi arsip pemerintah daerah. Cepat, akurat, dan gratis.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://karsip.pages.dev">
    <meta property="og:image" content="https://karsip.pages.dev/og-image.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="KArsip – Pencarian Kode Klasifikasi Arsip">
    <meta name="twitter:description" content="Cari kode klasifikasi arsip pemerintah daerah dengan cepat dan akurat.">
    <meta name="twitter:image" content="https://karsip.pages.dev/og-image.jpg">

    <link rel="canonical" href="https://karsip.pages.dev/">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">

    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-panel { background:white;border:1px solid #e2e8f0 }
        .hidden{display:none}
        .loader{
            border:3px solid #f3f3f3;
            border-top:3px solid #3b82f6;
            border-radius:50%;
            width:24px;height:24px;
            animation:spin .8s linear infinite
        }
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
</head>

<body class="min-h-screen flex flex-col text-slate-800 bg-white">

<header class="bg-slate-900 text-white py-8 sm:py-10 shadow-lg relative">
    <div class="container mx-auto px-4 text-center">
        <div class="text-3xl sm:text-4xl font-extrabold italic">
            <span class="text-blue-500">K</span><span class="text-red-500">A</span>rsip
        </div>
        <h1 class="text-sm sm:text-base md:text-lg font-medium text-slate-300 mt-1">
            Pencarian Kode Klasifikasi Arsip Pemerintah Daerah
        </h1>
    </div>

    <nav class="mt-4 flex justify-center gap-6 sm:absolute sm:top-6 sm:left-6 sm:mt-0 text-sm font-semibold">
        <a href="index.html" class="hover:text-blue-400">Home</a>
        <a href="tentang.html" class="hover:text-blue-400">Tentang</a>
        <a href="kontak.html" class="hover:text-blue-400">Kontak</a>
    </nav>
</header>

<main id="page-home" class="flex-grow container mx-auto px-4 mt-8 pb-24 relative">
    <div class="max-w-xl sm:max-w-3xl mx-auto">
        <form id="searchForm" class="flex flex-col sm:flex-row gap-2 items-stretch sm:items-center">
            <input id="searchInput" 
                   class="w-full flex-grow px-4 py-3 rounded-lg border bg-gray-50 text-base" 
                   placeholder="Ketik kata atau kalimat yang dicari...">
            <button type="submit" 
                    class="px-4 py-2 sm:px-6 sm:py-3 bg-blue-600 text-white rounded-lg text-sm sm:text-base font-semibold w-full sm:w-auto hover:bg-blue-700 transition">
                CARI
            </button>
        </form>

        <section class="text-sm text-gray-700 mt-4 text-center">
            <p>Cari kode klasifikasi arsip pemerintah daerah dengan cepat dan akurat.</p>
        </section>

        <div id="home-loader" class="hidden mt-6 flex justify-center">
            <div class="loader mx-auto"></div>
        </div>
    </div>

    <div class="max-w-3xl mx-auto mt-6">
        <div id="searchInfo" class="text-sm text-gray-500 mb-3 text-center"></div>
        <div id="resultsContainer" class="space-y-3"></div>
    </div>
</main>

<script>
    // Script tetap sama karena sudah menggunakan DOMContentLoaded
    document.addEventListener("DOMContentLoaded", () => {
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT3jPw6CxKWkDyP-bIKQ0Wqd5KxokevU_5StuP6og0Y2frtVmHdZngrTr7xyXtipPF9JzfduelqSJH1/pub?output=csv";
        let archiveData = [];

        function loadData() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    archiveData = results.data;
                    console.log("Data berhasil dimuat");
                },
                error: function(err) {
                    console.error("Gagal load data:", err);
                }
            });
        }

        function performSearch(q){
            const terms = q.toLowerCase().split(" ");
            return archiveData.filter(i=>{
                const text = `${i.KODE_KLASIFIKASI||""} ${i.URAIAN||""} ${i.KEYWORD||""}`.toLowerCase();
                return terms.every(term => text.includes(term));
            }).slice(0,50);
        }

        function makeBreadcrumb(kode){
            const parts = kode.split(".");
            let path=[], result=[];
            for(let i=0;i<parts.length;i++){
                path.push(parts[i]);
                result.push(path.join("."));
            }
            return result.join(" &gt; ");
        }

        function showResults(q){
            const data = performSearch(q);
            const c = document.getElementById("resultsContainer");
            const info = document.getElementById("searchInfo");

            document.getElementById("home-loader").classList.add("hidden");

            if(data.length > 0){
                info.innerHTML = `Menampilkan hasil untuk: <b>${q}</b>`;
            } else {
                info.innerHTML = `Tidak ditemukan hasil untuk <b>${q}</b>`;
            }

            c.innerHTML = data.map(i=>`
                <div class="border border-gray-200 rounded-xl p-4 shadow-sm hover:border-blue-400 transition">
                    <div class="text-[11px] sm:text-xs text-gray-500 mb-1 font-mono break-words">
                        ${makeBreadcrumb(i.KODE_KLASIFIKASI)}
                    </div>
                    <div class="font-mono text-blue-700 font-bold text-base sm:text-lg break-words">
                        ${i.KODE_KLASIFIKASI}
                    </div>
                    <div class="mt-1 text-sm sm:text-base font-medium text-slate-700">
                        ${i.URAIAN}
                    </div>
                </div>
            `).join("");
        }

        document.getElementById("searchForm").addEventListener("submit", e=>{
            e.preventDefault();
            const q = document.getElementById("searchInput").value.trim();
            if(q.length < 2) return;
            document.getElementById("home-loader").classList.remove("hidden");
            setTimeout(()=>showResults(q), 200);
        });

        loadData();
    });
</script>

</body>
</html>